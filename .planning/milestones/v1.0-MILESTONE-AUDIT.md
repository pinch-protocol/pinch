---
milestone: v1.0
audited: 2026-02-27T16:00:00Z
status: tech_debt
scores:
  requirements: 46/46
  phases: 7/7
  integration: 46/46
  flows: 7/7
gaps:
  requirements: []
  integration:
    - id: "RELY-06"
      issue: "TrackFlushKey/PopFlushKey dead code in relay hub — flush keys never populated, PopFlushKey always returns (nil,false)"
      severity: low
      affected_files: ["relay/internal/hub/client.go", "relay/internal/hub/hub.go"]
      note: "Correctness maintained by immediate deletion during flush; dead code should be removed for clarity"
  flows: []
tech_debt:
  - phase: 01-foundation-and-crypto-primitives
    items:
      - "relay/cmd/pinchd/main.go: InsecureSkipVerify=true in WebSocket accept (development aid, needs lockdown for production)"
  - phase: 02-authentication-and-connection
    items:
      - "skill/src/connection.ts: Empty pubkey bytes in ConnectionRequest/ConnectionResponse payloads (design deviation — relies on relay auth; works because Phase 3 wires keypair.publicKey)"
  - phase: 04-store-and-forward
    items:
      - "relay/internal/hub/client.go: TrackFlushKey/PopFlushKey dead code — delivery-confirmation-based removal path never activated due to immediate-delete strategy"
  - phase: 05-full-autonomy-and-permissions
    items:
      - "skill/SKILL.md lines 259-278: Permission tier names incorrect (documents read/read_write/execute instead of actual full_details/propose_and_book/specific_folders/everything/scoped/full)"
  - phase: 06-oversight-and-safety
    items:
      - "pinch-permissions, pinch-audit-verify, pinch-audit-export: Open full relay WebSocket connection via bootstrap() but only need local SQLite — unnecessary auth handshake overhead"
  - phase: 07-wire-cli-tools-and-persist-attribution
    items:
      - "dist/ integration tests have ECONNREFUSED failures (pre-existing test infrastructure issue, not related to Phase 7 changes)"
---

# Milestone v1.0 Audit Report

**Milestone:** v1.0 — Pinch Secure Agent-to-Agent Messaging
**Audited:** 2026-02-27T16:00:00Z
**Status:** tech_debt (all requirements met, no critical gaps, accumulated deferred items)
**Previous audit:** 2026-02-27T08:45:00Z (gaps_found — resolved by Phase 7)

## Scores

| Dimension | Score | Details |
|-----------|-------|---------|
| Requirements | 46/46 | All v1 requirements satisfied across 3 independent sources |
| Phases | 7/7 | All 7 phases verified (6 passed, 1 gaps_found — documentation only) |
| Integration | 46/46 | All requirement integration paths wired and verified |
| E2E Flows | 7/7 | All 7 major flows complete end-to-end |

## Milestone Definition of Done

From PROJECT.md: Agents can securely message each other with human consent and oversight at every step — no message flows without explicit human approval of the connection.

7 phases delivered:
1. Foundation and Crypto Primitives — proto schema, Ed25519 identity, Go relay
2. Authentication and Connection — challenge-response auth, connection lifecycle, blocking
3. Encrypted 1:1 Messaging — NaCl box E2E encryption, message management, skill tools
4. Store-and-Forward — bbolt message queue, flush-on-reconnect
5. Full Autonomy and Permissions — 4-tier autonomy, permissions manifest, circuit breakers
6. Oversight and Safety — activity feed, rate limiting, intervention, muting, audit
7. Wire CLI Tools and Persist Attribution — bin entries, attribution column, pinch-history update

## 3-Source Requirements Cross-Reference

**Sources:**
1. REQUIREMENTS.md traceability table — 46/46 `[x]` Complete
2. SUMMARY.md frontmatter `requirements-completed` — all 46 IDs present across 21 summaries
3. VERIFICATION.md per-phase requirements tables — all 46 SATISFIED

### Identity (3/3)

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Final |
|--------|-------------|-------------|---------|--------------|-------|
| IDNT-01 | Ed25519 keypair generation and persistence | Phase 1: passed | 01-02 | [x] | satisfied |
| IDNT-02 | pinch: address derivation from public key | Phase 1: passed | 01-02 | [x] | satisfied |
| IDNT-03 | Keypair reload from storage on startup | Phase 1: passed | 01-02 | [x] | satisfied |

### Protocol (4/4)

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Final |
|--------|-------------|-------------|---------|--------------|-------|
| PROT-01 | Protocol Buffers wire format with Go and TS codegen | Phase 1: passed | 01-01 | [x] | satisfied |
| PROT-02 | Version field in protocol envelope | Phase 1: passed | 01-01 | [x] | satisfied |
| PROT-03 | Sequence numbers for replay protection | Phase 1: passed | 01-01 | [x] | satisfied |
| PROT-04 | Timestamps for replay protection and ordering | Phase 1: passed | 01-01 | [x] | satisfied |

### Relay (8/8)

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Final |
|--------|-------------|-------------|---------|--------------|-------|
| RELY-01 | WebSocket relay accepts connections | Phase 1: passed | 01-03 | [x] | satisfied |
| RELY-02 | Ed25519 challenge-response auth | Phase 2: passed | 02-01 | [x] | satisfied |
| RELY-03 | Routing table mapping addresses to connections | Phase 1: passed | 01-03 | [x] | satisfied |
| RELY-04 | Real-time sub-100ms delivery | Phase 3: passed | 03-01 | [x] | satisfied |
| RELY-05 | Offline message queue with 7-day TTL | Phase 4: passed | 04-01, 04-02 | [x] | satisfied |
| RELY-06 | Reconnect flush in order | Phase 4: passed | 04-02 | [x] | satisfied |
| RELY-07 | Per-connection rate limiting | Phase 6: passed | 06-02 | [x] | satisfied |
| RELY-08 | Ping/pong heartbeats (25s/7s) | Phase 1: passed | 01-03 | [x] | satisfied |

### Encryption (5/5)

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Final |
|--------|-------------|-------------|---------|--------------|-------|
| CRYP-01 | NaCl box E2E encryption | Phase 3: passed | 03-02, 03-03 | [x] | satisfied |
| CRYP-02 | Ed25519 to X25519 key conversion | Phase 1: passed | 01-02 | [x] | satisfied |
| CRYP-03 | 24-byte random nonce from CSPRNG | Phase 1: passed | 01-02 | [x] | satisfied |
| CRYP-04 | Cross-language crypto roundtrip in CI | Phase 1: passed | 01-02 | [x] | satisfied |
| CRYP-05 | E2E signed delivery confirmations | Phase 3: passed | 03-01, 03-02, 03-03 | [x] | satisfied |

### Connection (6/6)

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Final |
|--------|-------------|-------------|---------|--------------|-------|
| CONN-01 | Send connection request | Phase 2: passed | 02-03, 02-04 | [x] | satisfied |
| CONN-02 | Human approves/rejects connection request | Phase 2: passed | 02-03, 02-04 | [x] | satisfied |
| CONN-03 | Public key exchange on approval | Phase 2: passed | 02-04 | [x] | satisfied |
| CONN-04 | Block with relay enforcement | Phase 2: passed | 02-02 | [x] | satisfied |
| CONN-05 | Mute connection (delivered but not surfaced) | Phase 6+7: passed | 06-03, 07-01 | [x] | satisfied |
| CONN-06 | Revoke connection without blocking | Phase 2: passed | 02-04 | [x] | satisfied |

### Autonomy (10/10)

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Final |
|--------|-------------|-------------|---------|--------------|-------|
| AUTO-01 | Configurable autonomy level per connection | Phase 2: passed | 02-03 | [x] | satisfied |
| AUTO-02 | New connections default Full Manual | Phase 2: passed | 02-03 | [x] | satisfied |
| AUTO-03 | Full Manual queues for human approval | Phase 5: passed | 05-01 | [x] | satisfied |
| AUTO-04 | Notify processes and notifies human | Phase 5: passed | 05-01 | [x] | satisfied |
| AUTO-05 | Auto-respond handles within rules, logs all | Phase 5: passed | 05-02 | [x] | satisfied |
| AUTO-06 | Full Auto operates independently, audit trail | Phase 5: passed | 05-01 | [x] | satisfied |
| AUTO-07 | Human changes autonomy at any time | Phase 5: passed | 05-01 | [x] | satisfied |
| AUTO-08 | Inbound permissions manifest | Phase 5: passed | 05-02 | [x] | satisfied |
| AUTO-09 | Permissions enforced before LLM | Phase 5: passed | 05-02 | [x] | satisfied |
| AUTO-10 | Circuit breaker auto-downgrade | Phase 5: passed | 05-03 | [x] | satisfied |

### Oversight (6/6)

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Final |
|--------|-------------|-------------|---------|--------------|-------|
| OVRS-01 | Activity feed for all messages and events | Phase 6+7: passed | 06-01, 07-01 | [x] | satisfied |
| OVRS-02 | Activity feed filterable by connection/time/type | Phase 6+7: passed | 06-01, 07-01 | [x] | satisfied |
| OVRS-03 | Human intervention (take over conversations) | Phase 6+7: passed | 06-03, 07-01 | [x] | satisfied |
| OVRS-04 | Agent/human message attribution | Phase 6+7: passed | 06-03, 07-01 | [x] | satisfied |
| OVRS-05 | Tamper-evident audit log with hash chaining | Phase 6+7: passed | 06-01, 06-04, 07-01 | [x] | satisfied |
| OVRS-06 | Audit log entry fields (timestamp, pubkey, etc.) | Phase 6: passed | 06-01, 06-04 | [x] | satisfied |

### Skill Integration (4/4)

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Final |
|--------|-------------|-------------|---------|--------------|-------|
| SKIL-01 | OpenClaw SKILL.md with YAML frontmatter | Phase 3: passed | 03-04 | [x] | satisfied |
| SKIL-02 | Persistent WebSocket via heartbeat cycle | Phase 3: passed | 03-04 | [x] | satisfied |
| SKIL-03 | Outbound tools follow OpenClaw patterns | Phase 3: passed | 03-04 | [x] | satisfied |
| SKIL-04 | Inbound routing based on autonomy level | Phase 3: passed | 03-03, 03-04 | [x] | satisfied |

**Orphan check:** 0 orphaned requirements. All 46 traceability entries appear in at least one VERIFICATION.md.

## Previous Gaps — Resolved by Phase 7

The previous audit (2026-02-27T08:45:00Z) found 2 gaps:

1. **Phase 6 CLI tools missing from package.json bin** — Phase 7 added all 5 bin entries (pinch-activity, pinch-intervene, pinch-mute, pinch-audit-verify, pinch-audit-export). Now 12 total bin entries.
2. **Inbound attribution not persisted to SQLite** — Phase 7 added `attribution` column to messages schema, field to `MessageRecord`, and persistence in `handleIncomingMessage()`. `pinch-history` now surfaces attribution.

Both gaps fully closed and verified in 07-VERIFICATION.md.

## Phase Verification Summary

| Phase | Name | Status | Score | Requirements |
|-------|------|--------|-------|--------------|
| 1 | Foundation and Crypto Primitives | passed | 13/13 | 13/13 |
| 2 | Authentication and Connection | passed | 12/12 | 8/8 |
| 3 | Encrypted 1:1 Messaging | passed | 14/14 | 7/7 |
| 4 | Store-and-Forward | passed | 10/10 | 2/2 |
| 5 | Full Autonomy and Permissions | gaps_found | 21/22 | 8/8 |
| 6 | Oversight and Safety | passed | 5/5 | 8/8 |
| 7 | Wire CLI Tools and Attribution | passed | 4/4 | 6/6 |

Phase 5 gap: SKILL.md permission tier names incorrect (documentation bug, no requirement affected).

## Integration Check Results

**47 cross-phase connections checked.** 0 orphaned exports. 0 broken flows.

### E2E Flows Verified

| # | Flow | Status | Requirements |
|---|------|--------|-------------|
| 1 | Agent A encrypts and sends to Agent B through relay | Complete | CRYP-01, RELY-04, CRYP-05 |
| 2 | Offline agent receives queued messages on reconnect | Complete | RELY-05, RELY-06 |
| 3 | New connection → approve → key exchange → messaging | Complete | CONN-01, CONN-02, CONN-03, AUTO-02 |
| 4 | Enforcement pipeline: permissions → CB → routing | Complete | AUTO-08, AUTO-09, AUTO-10 |
| 5 | Human intervention: passthrough, attribution, feed | Complete | OVRS-03, OVRS-04, OVRS-01 |
| 6 | Bootstrap wires all components correctly | Complete | All phases |
| 7 | All 12 CLI tools invocable via package.json bin | Complete | SKIL-03 |

### Integration Notes (Non-blocking)

1. **TrackFlushKey dead code** (RELY-06, low): `client.go` defines `TrackFlushKey`/`PopFlushKey` but `TrackFlushKey` never called during flush. Correctness maintained by immediate deletion.
2. **Unnecessary relay connections** (informational): `pinch-permissions`, `pinch-audit-verify`, `pinch-audit-export` open relay WebSocket but only need local SQLite.

## Tech Debt by Phase

### Phase 1: Foundation and Crypto Primitives
- `InsecureSkipVerify: true` in WebSocket accept options (dev aid, needs production lockdown)

### Phase 2: Authentication and Connection
- Empty pubkey bytes in ConnectionRequest/ConnectionResponse (design deviation, relay auth suffices)

### Phase 4: Store-and-Forward
- `TrackFlushKey`/`PopFlushKey` dead code in hub — should be removed for clarity

### Phase 5: Full Autonomy and Permissions
- SKILL.md lines 259-278: Permission tier names incorrect (documents `read`/`read_write`/`execute` instead of `full_details`/`propose_and_book`/`specific_folders`/`everything`/`scoped`/`full`)

### Phase 6: Oversight and Safety
- 3 CLI tools open unnecessary relay WebSocket via bootstrap()

### Phase 7: Wire CLI Tools and Attribution
- `dist/` integration tests have ECONNREFUSED failures (pre-existing infra issue)

**Total: 6 items across 6 phases. None are blockers.**

---

_Audited: 2026-02-27T16:00:00Z_
_Auditor: Claude (gsd-milestone-audit orchestrator)_
_Previous audit: 2026-02-27T08:45:00Z (gaps_found → resolved by Phase 7)_
